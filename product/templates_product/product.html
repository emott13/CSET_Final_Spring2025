<link rel="stylesheet" href="/static/styles/styles.css">
<script src="/static_product/js/product.js" defer></script>
{% extends 'base.html' %}
{% block body %}
    <div class="full-height full-width">
        <div class="product-container">

            <div class="product-image-container">
                <img class="product-img" src="{{imageData[0][ii['file_path']]}}">
                <div class="product-img-select">
                    {% for image in imageData %}
                        <div class="product-img-small">
                            <img src="{{image[ii['file_path']]}}">
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="product-info-container">
                <h1 class="product-title">{{productData[pi['product_title']]}}</h1>
                <p class="vendor-username">Vendor: {{productData[pi['username']]}}</p>
                <div class="product-rating">
                    {% if reviewsAvg %}
                        {% if reviewsAvg > 0.7 %}
                            <i class="fa-solid fa-star star-orange"></i>
                        {% else %}
                            <i class="fa-regular fa-star star-orange"></i>
                        {% endif %}
                        {% if reviewsAvg > 1.7 %}
                            <i class="fa-solid fa-star star-orange"></i>
                        {% else %}
                            <i class="fa-regular fa-star star-orange"></i>
                        {% endif %}
                        {% if reviewsAvg > 2.7 %}
                            <i class="fa-solid fa-star star-orange"></i>
                        {% else %}
                            <i class="fa-regular fa-star star-orange"></i>
                        {% endif %}
                        {% if reviewsAvg > 3.7 %}
                            <i class="fa-solid fa-star star-orange"></i>
                        {% else %}
                            <i class="fa-regular fa-star star-orange"></i>
                        {% endif %}
                        {% if reviewsAvg > 4.7 %}
                            <i class="fa-solid fa-star star-orange"></i>
                        {% else %}
                            <i class="fa-regular fa-star star-orange"></i>
                        {% endif %}
                        <p class="product-rating-num">{{reviewsAvg}}</p>
                    {% else %}
                        <p class="">No reviews</p>
                    {% endif %}
                </div>

                <div class="product-separator"></div> 


                <div class="flex flex-between">
                    {% if allDiscountData[variantData[vi['variant_id']]] and 
                        allDiscountData[variantData[vi['variant_id']]] < variantData[vi['price']] %}
                        <h3 class="product-price">${{ allDiscountData[variantData['variant_id']]|priceFormat }}</h3>
                    {% else %}
                        <h3 class="product-price">${{ variantData[vi['price']]|priceFormat }}</h3>
                    {% endif %}
                    {% if error %}
                        <p class="error product-small-font">{{error}}</p>
                    {% endif %}
                    <form action="" method="POST" class="product-cart-form">
                        <input type="number" name="number" value="1" min="1" max="100" onchange="checkNum(this)">
                        <input type="submit" class="btn" value="Add To Cart">
                    </form>
                </div>
                {% if allDiscountData[variantData[vi['variant_id']]] and 
                    allDiscountData[variantData[vi['variant_id']]] < variantData[vi['price']] %}
                    <p class="product-list-price">List Price: <s>${{ variantData[vi['price']]|priceFormat }}</s></p>
                {% endif %}

                <p class="product-size-selected product-small-font">Size: <a id="size-selected">{{variantData[vi['size_description']]}}</a></p>
                <p class="product-color-selected product-small-font">
                    Color: <a id="color-selected">{{variantData[vi['color_name']]}}</a>
                    {% if variantData[vi['color_hex']] != 'NULL' %}
                        <a class="product-color-box" style="background-color: {{variantData[vi['color_hex']]}}"></a>
                    {% endif %}
                </p>
                <div class="product-sizes-container">
                    {% for variant in allVariantData %}
                    <a class="variant-size-container" href="/product/{{variant[vi['product_id']]}}/{{variant[vi['variant_id']]}}">
                        <div class="variant-color-size">
                            <p class="variant-size">{{variant[vi['size_description']]}}</p>
                            <p class="variant-color">{{variant[vi['color_name']]}}</p>
                        </div>
                        <div class="variant-separator"></div>
                        {% if variantData[vi['color_hex']] != 'NULL' %}
                            <p class="variant-color-back" style="background-color: {{variant[vi['color_hex']]}}"></p>
                        {% endif %}
                        <div class="variant-separator"></div>
                        <div class="variant-price">
                            {% if allDiscountData[variant[vi['variant_id']]] and 
                                allDiscountData[variant[vi['variant_id']]] < variant[vi['price']] %}
                                    <p class="">${{ allDiscountData[variant[vi['variant_id']]]|priceFormat }}</p>
                                    <p class=""><s>${{ variant[vi['price']]|priceFormat }}</s></p>
                            {% else %}
                                <p class="">${{ variant[vi['price']]|priceFormat }}</p>
                            {% endif %}
                        </div>
                    </a>
                    {% endfor %}
                </div>

                <h2 class="product-description-h2 top-margin">Description</h2>
                <p class="product-description top-margin product-small-font">{{productData[pi['product_description']]}}</p>
                {% if productData[pi['warranty_months']] > 0 %}
                    <p class="product-warranty top-margin product-small">
                        This product has a {{productData[pi['warranty_months']]}} month warranty
                    </p>
                {% endif %}
            </div>

        </div>

        <section class="product-reviews-section">
            <div class="product-reviews-container">
                <h1 class="reviews-h">Reviews</h1>

                <div class="product-reviews-arrange product-reviews-background">
                    <div class="product-reviews-filter">
                        <label class="product-filter">Filter</label>
                        <select id="product-sort">
                            <option value="all">All Stars</option>
                            <option value="5">5 Star</option>
                            <option value="4">4 Star</option>
                            <option value="3">3 Star</option>
                            <option value="2">2 Star</option>
                            <option value="1">1 Star</option>
                            <option value="pos">Positive Reviews</option>
                            <option value="crit">Critical Reviews</option>
                        </select> 
                    </div>
                    <div class="product-reviews-sort">
                        <label class="product-sort">Sort</label>
                        <select id="product-sort">
                            <option value="recent">Recent First</option>
                            <option value="pos">Positive Reviews First</option>
                            <option value="crit">Critical Reviews First</option>
                        </select> 
                    </div>
                </div>

                {% for review in reviewsData %}
                    <div class="product-review product-reviews-background">
                        <div class="product-review-row1">
                            <p class="product-review-name product-reviews-inner-background">By: {{review[ri['full_name']]}}</p>
                            <div class="product-review-stars product-reviews-inner-background">
                                {% for i in range(1, 6) %}
                                    {% if i <= review[ri['rating']] %}
                                        <i class="fa-solid fa-star star-orange"></i>
                                    {% else %}
                                        <i class="fa-regular fa-star star-orange"></i>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <p class="product-review-date product-reviews-inner-background">{{review[ri['date']]}}</p>
                        </div>
                        {% if review[ri['description']] %}
                            <div class="product-review-description product-reviews-inner-background">
                                <p>{{review[ri['description']]}}</p>
                            </div>
                        {% endif %}
                        {% if review[ri['image']] %}
                            <div class="product-review-image">
                                <img src="{{review[ri['image']]}}" class="product-reviews-inner-background">
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </section>
    </div>
{% endblock %}